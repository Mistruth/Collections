# 第三节 连接管理

### 什么是TCP连接
TCP(传输控制协议)，是为应用层提供可靠的比特传输管道
它的特点是：
+ 按序
+ 无差错
如何传输的？
> 将数据流切割成TCP段，将段封装在IP分组当中，每一个IP分组包括：一个IP分组首部，一个TCP段首部，一个TCP数据块

### TCP性能优化

#### HTTP事务时延
+ DNS解析
+ TCP建立时延
+ 硬件速度、数据大小、距离等

#### TCP握手时延
```
客户端 ----- SYN -----> 服务端 （TCP客户端向服务端发送一个SYN标记的TCP分组）
客户端 <---SYN + ACK --- 服务端 （TCP服务端回送一个TCP分组 并带有SYN和ACK的标记）
客户端 ---- ACK ----> 服务端 （TCP客户端回送ACK 双方可以开始通信 也允许将数据带到这一次回送中）
```

#### TCP延迟确认算法
TCP段中有一个序列号和数据完整性校验和，接收者在得到后会回送一个确认的请求，延迟确认是通过在一定时间内得到的确认信息都缓存起来一次性发送给发送者

#### TCP慢启动
TCP连接在建连的时候会限制传输速度，之后速度会提高

#### Nagle算法
因为每一个TCP段的大小最小都是40个字节的标记和首部
所以Nagle算法能够将小数据的TCP分组合并起来一次发送
但是这种情况也会为了凑齐小分组而造成延迟

### HTTP中如何提高性能
+ 并行连接 (浏览器一般是同一时间允许四个并行连接)
+ 持久连接 (重用TCP连接)
首部添加Connection:Keep-Alive表示单方面希望保持连接
但是报文的长度必须正确，Content-Length必须正确或者使用
分块传输编码的方式

### 幂等性
GET和POST理解
GET请求具有幂等性 得到的结果都是一样的，在非预期关闭的连接情况下，可以重试
但是POST请求是非幂等性的，因此要确保下一次的响应结果出现后，再允许用户进行
发送比较保险，比如订单之类的请求
